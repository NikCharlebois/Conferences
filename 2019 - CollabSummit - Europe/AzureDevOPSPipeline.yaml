pool:
  # Options are
  # Visual Studio 2019 Preview on Windows Server 2019 (windows-2019)
  # Visual Studio 2017 on Windows Server 2016 (vs2017-win2016)
  # Visual Studio 2015 on Windows Server 2012R2 (vs2015-win2012r2)
  # Windows Server 1803 (win1803) - for running Windows containers
  # macOS X Mojave 10.14 (macOS-10.14)
  # macOS X High Sierra 10.13 (macOS-10.13)
  # Ubuntu 16.04 (ubuntu-16.04)
  vmImage: 'windows-2019'

steps:
- task: AzurePowerShell@4
  inputs:
    azureSubscription: 'Consommation interne Microsoft Azure (aeaea727-e899-4c3b-9cdf-9dcfc75f4f2e)'
    ScriptType: 'InlineScript'
    Inline: |
           Write-Host "Setting Security Protocol"
           [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12
           Write-Host "Downloading Azure Stack Tools"
           invoke-webrequest "https://github.com/Azure/AzureStack-Tools/archive/master.zip" -OutFile master.zip
           Write-Host "Extracting Azure Stack Toolss"
           expand-archive master.zip -DestinationPath . -Force
           cd AzureStack-Tools-master
           Write-Host "Importing Cloud Capabilities Module"
           Import-Module "./CloudCapabilities/AzureRM.CloudCapabilities.psm1"
           Write-Host "Obtaining Capabilities from the selected location"
           Get-AzureRMCloudCapability -Location "westus" -Verbose
           Import-Module "./TemplateValidator/AzureRM.TemplateValidator.psm1"
           Write-Host "Testing Template"
           Test-AzureRMTemplate -TemplatePath "2019 - CollabSummit - Europe/azuredeploy.json" -CapabilitiesPath "./CloudCapabilities/AzureCloudCapabilities.Json" -Verbose
    azurePowerShellVersion: 'LatestVersion'
  displayName: 'Test ARM Templates'
- task: CopyFiles@2
  displayName: "Obtain Files from GitHub"
  inputs:
    SourceFolder: '2019 - CollabSummit - Europe'
    TargetFolder: '$(build.artifactstagingdirectory)/CollabSummit'
- task: PublishBuildArtifacts@1
  displayName: 'Publish Artifact: Demo'
  inputs:
    ArtifactName: Demo